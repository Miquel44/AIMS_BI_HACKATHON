<!DOCTYPE html>
<html lang="en" x-data="patientSelector()">
<head>
    <meta charset="UTF-8">
    <title>Select Patient</title>

    <!-- AlpineJS -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.8/dist/cdn.min.js" defer></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        .patient-card {
            transition: transform .15s ease, box-shadow .15s ease;
            cursor: pointer;
        }
        .patient-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
        }

        .patient-list {
            max-height: 70vh;
            overflow-y: auto;
        }

        .patient-id-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.7rem;
        }
    </style>

    <script>
        function patientSelector() {
            return {
                search: "",
                patients: {{ patients | tojson }},

                get filteredPatients() {
                    if (!this.search.trim()) return this.patients;

                    const s = this.search.toLowerCase();
                    return this.patients.filter(p =>
                        p.name.toLowerCase().includes(s) ||
                        p.id.toLowerCase().includes(s)
                    );
                },

                goToPatient(id) {
                    window.location.href = '/patient-record?patient_id=' + id;
                }
            }
        }
    </script>
</head>

<body class="bg-light p-4">

<div class="container">

    <h1 class="mb-4">Select a Patient</h1>

    <!-- Search Bar -->
    <div class="mb-4">
        <input type="text"
               class="form-control form-control-lg"
               placeholder="Search by name or ID..."
               x-model="search">
    </div>

    <!-- Patient List -->
    <div class="patient-list">
        <template x-for="p in filteredPatients" :key="p.id">
            <div class="card mb-3 position-relative patient-card"
                 @click="goToPatient(p.id)">

                <span class="badge bg-secondary patient-id-badge" x-text="p.id"></span>

                <div class="card-body">
                    <h5 class="card-title" x-text="p.name"></h5>

                    <p class="mb-1">
                        <strong>DOB:</strong>
                        <span x-text="p.dob"></span>
                    </p>

                    <p class="mb-0">
                        <strong>Gender:</strong>
                        <span x-text="p.gender"></span>
                    </p>
                </div>
            </div>
        </template>

        <template x-if="filteredPatients.length === 0">
            <p class="text-muted text-center mt-4">No patients found</p>
        </template>
    </div>

</div>

</body>
</html>
